Publicidade/Product ADS

/ (raiz do projeto)
â”œâ”€ index.js                         # Sobe o Express, registra as rotas
â”‚   â””â”€ usa routes/publicidadeRoutes.js
â”‚
â”œâ”€ routes/
â”‚   â”œâ”€ publicidadeRoutes.js         # Rotas HTTP de Product Ads
â”‚   â”‚   â€¢ GET /publicidade          -> abre a tela (view)
â”‚   â”‚   â€¢ GET /api/publicidade/product-ads/campaigns
â”‚   â”‚   â€¢ GET /api/publicidade/product-ads/campaigns/:id/items
â”‚   â”‚   â€¢ GET /api/publicidade/product-ads/metricas-diarias
â”‚   â”‚   â””â”€ chama PublicidadeController
â”‚   â”‚
â”‚   â””â”€ ... (outras rotas)
â”‚
â”œâ”€ controllers/
â”‚   â”œâ”€ PublicidadeController.js     # Camada de controller / API
â”‚   â”‚   â€¢ listarCampanhas(req,res)          -> ProductAdsService.listarCampanhas()
â”‚   â”‚   â€¢ listarItensCampanha(req,res)      -> ProductAdsService.listarItensCampanha()
â”‚   â”‚   â€¢ metricasDiarias(req,res)         -> ProductAdsService.metricasDiarias()
â”‚   â”‚   â””â”€ responde JSON para o front
â”‚   â”‚
â”‚   â””â”€ ... (outros controllers)
â”‚
â”œâ”€ services/
â”‚   â”œâ”€ productAdsService.js         # ğŸ’¥ AQUI estÃ¡ toda a lÃ³gica de Product Ads
â”‚   â”‚   â€¢ urls()                                -> endpoints do ML
â”‚   â”‚   â€¢ withAuth() / prepararAuth()          -> token + chamadas autenticadas
â”‚   â”‚   â€¢ obterAdvertiserId()                  -> pega advertiser da conta
â”‚   â”‚   â€¢ buscarThumbnailsParaItens()         -> ğŸ” busca thumbnails em /items
â”‚   â”‚   â€¢ listarCampanhas()                    -> campanhas agregadas
â”‚   â”‚   â€¢ listarItensCampanha()                -> itens + mÃ©tricas + thumbnail
â”‚   â”‚   â€¢ metricasDiarias()                    -> sÃ©rie diÃ¡ria para grÃ¡fico
â”‚   â”‚   â€¢ exportarItensCampanhaCsv()           -> export CSV
â”‚   â”‚
â”‚   â””â”€ tokenService.js / tokenService/index.js # usado por prepararAuth()/withAuth()
â”‚
â”œâ”€ views/
â”‚   â”œâ”€ publicidade.ejs               # Tela â€œPainel de Product Adsâ€
â”‚   â”‚   â€¢ tabela de ranking de campanhas
â”‚   â”‚   â€¢ tabela de itens da campanha
â”‚   â”‚   â€¢ inclui <script src="/js/publicidade.js">
â”‚   â”‚
â”‚   â””â”€ partials/â€¦                    # (se tiver componentes reaproveitados)
â”‚
â””â”€ public/
    â”œâ”€ js/
    â”‚   â”œâ”€ publicidade.js           # Frontend da tela
    â”‚   â”‚   â€¢ busca /api/publicidade/product-ads/campaigns
    â”‚   â”‚   â€¢ busca /api/publicidade/product-ads/campaigns/:id/items
    â”‚   â”‚   â€¢ aplica filtros, paginaÃ§Ã£o (20 itens por pÃ¡gina)
    â”‚   â”‚   â€¢ monta o HTML das linhas, usando `item.thumbnail`
    â”‚   â”‚   â€¢ (vamos colocar aqui o loading de lista / filtros)
    â”‚   â”‚
    â”‚   â””â”€ helpers/â€¦, outros .js
    â”‚
    â”œâ”€ css/
    â”‚   â”œâ”€ publicidade.css          # (se tiver um CSS especÃ­fico da tela)
    â”‚   â””â”€ main.css / theme.css     # estilos globais
    â”‚
    â””â”€ img/
        â””â”€ ...                      # Ã­cones, placeholders de imagem, etc.


Produtos/Validar dimensÃµes

/ (raiz do projeto)
â”œâ”€ index.js                               # Sobe o Express, registra as rotas e pÃ¡ginas
â”‚   â”œâ”€ usa routes/validarDimensoesRoutes.js      (API)
â”‚   â””â”€ GET /validar-dimensoes                    (view HTML da tela)
â”‚
â”œâ”€ routes/
â”‚   â”œâ”€ validarDimensoesRoutes.js          # Rotas HTTP da feature "Validar DimensÃµes"
â”‚   â”‚   â€¢ POST /api/validar-dimensoes/analisar-item
â”‚   â”‚       -> ValidarDimensoesController.analisarItem()
â”‚   â”‚   â””â”€ (futuro) ex.: /api/validar-dimensoes/verificar-nulos-conta, etc.
â”‚   â”‚
â”‚   â””â”€ ... (outras rotas)
â”‚
â”œâ”€ controllers/
â”‚   â”œâ”€ ValidarDimensoesController.js      # Controller da validaÃ§Ã£o de dimensÃµes
â”‚   â”‚   â€¢ getAccountMeta(res)                    -> pega chave/label da conta atual
â”‚   â”‚   â€¢ getCreds(res)                         -> pega mlCreds do res.locals (authMiddleware)
â”‚   â”‚   â€¢ analisarItem(req,res)
â”‚   â”‚       - valida body.mlb
â”‚   â”‚       - monta opts { mlCreds, accountKey }
â”‚   â”‚       - chama ValidarDimensoesService.analisarUm(mlb, opts)
â”‚   â”‚       - responde JSON:
â”‚   â”‚           { success: true, data: { mlb, raw, height_cm, ... }, account: {...} }
â”‚   â”‚
â”‚   â””â”€ ... (outros controllers)
â”‚
â”œâ”€ services/
â”‚   â”œâ”€ validarDimensoesService.js         # ğŸ’¥ NÃºcleo da lÃ³gica de dimensÃµes
â”‚   â”‚   â€¢ urls()
â”‚   â”‚       - resolve base de `items` via config.urls.items ou padrÃ£o ML
â”‚   â”‚   â€¢ prepararAuthState(options)
â”‚   â”‚       - mesmo padrÃ£o do adAnalysisService
â”‚   â”‚       - usa TokenService.renovarTokenSeNecessario(mlCreds)
â”‚   â”‚       - devolve { token, creds, key }
â”‚   â”‚   â€¢ authFetch(url, init, state)
â”‚   â”‚       - faz fetch com Authorization: Bearer {token}
â”‚   â”‚       - em 401, renova token via TokenService.renovar(state.creds) e tenta de novo
â”‚   â”‚   â€¢ parseDimensions(dimStr)
â”‚   â”‚       - recebe string tipo "9x19x19,500"
â”‚   â”‚       - separa em altura, largura, comprimento, peso (cm / g)
â”‚   â”‚       - devolve { height_cm, width_cm, length_cm, weight_g }
â”‚   â”‚   â€¢ ValidarDimensoesService.analisarUm(mlbId, options)
â”‚   â”‚       - chama /items/{mlbId}
â”‚   â”‚       - lÃª item.shipping.dimensions
â”‚   â”‚       - usa parseDimensions(...)
â”‚   â”‚       - retorna:
â”‚   â”‚           {
â”‚   â”‚             mlb,
â”‚   â”‚             success: true/false,
â”‚   â”‚             status: 'OK' | 'ERRO',
â”‚   â”‚             raw,           // string original do ML
â”‚   â”‚             height_cm,
â”‚   â”‚             width_cm,
â”‚   â”‚             length_cm,
â”‚   â”‚             weight_g,
â”‚   â”‚             message (em caso de erro)
â”‚   â”‚           }
â”‚   â”‚
â”‚   â””â”€ tokenService.js / ml-auth.js       # usados para renovar / obter tokens do ML
â”‚
â”œâ”€ views/
â”‚   â”œâ”€ validar-dimensoes.html             # Tela â€œValidar DimensÃµes (MLB)â€
â”‚   â”‚   â€¢ header com conta atual + botÃ£o "Status" + "Trocar conta"
â”‚   â”‚   â€¢ nav com abas (Dashboard, Produtos, IA & Analytics, etc.)
â”‚   â”‚   â€¢ card "Validar DimensÃµes":
â”‚   â”‚       - input MLB Ãºnico + botÃ£o "Analisar"
â”‚   â”‚       - textarea para lote de MLBs + delay entre requisiÃ§Ãµes
â”‚   â”‚       - barra de progresso (atual / total)
â”‚   â”‚       - tabela de resultados:
â”‚   â”‚           #, MLB, Altura, Largura, Comprimento, Peso, String bruta, Status
â”‚   â”‚       - botÃ£o "Exportar CSV"
â”‚   â”‚   â€¢ inclui:
â”‚   â”‚       <link rel="stylesheet" href="/css/validar-dimensoes.css">
â”‚   â”‚       <script src="/js/validar-dimensoes.js"></script>
â”‚   â”‚
â”‚   â””â”€ ... (outras views: dashboard.html, analise-anuncios.html, etc.)
â”‚
â””â”€ public/
    â”œâ”€ js/
    â”‚   â”œâ”€ validar-dimensoes.js           # Frontend da tela de validaÃ§Ã£o de dimensÃµes
    â”‚   â”‚   â€¢ helpers:
    â”‚   â”‚       - $, qs, qsa
    â”‚   â”‚       - ACCOUNT_LABELS
    â”‚   â”‚       - parseDimensions(dimStr)  // versÃ£o de front, usada pra exibir na tabela/CSV
    â”‚   â”‚   â€¢ estado:
    â”‚   â”‚       - currentAccountKey
    â”‚   â”‚       - resultados[] (lista de itens jÃ¡ analisados)
    â”‚   â”‚   â€¢ conta / token:
    â”‚   â”‚       - carregarContaAtual()     -> /api/account/current
    â”‚   â”‚       - trocarConta()           -> limpa cookie e redireciona /select-conta
    â”‚   â”‚       - abrirModalStatus(), fecharModalStatus()
    â”‚   â”‚       - verificarToken(updateModal)
    â”‚   â”‚       - renovarToken(updateModal)
    â”‚   â”‚   â€¢ comunicaÃ§Ã£o com a API:
    â”‚   â”‚       - fetchDimensoes(mlb)
    â”‚   â”‚           -> POST /api/validar-dimensoes/analisar-item
    â”‚   â”‚           -> trata HTTP != 200, erros de JSON, etc.
    â”‚   â”‚           -> devolve { mlb, raw, error? }
    â”‚   â”‚       - processarLote(mlbs[])
    â”‚   â”‚           -> zera resultados
    â”‚   â”‚           -> laÃ§o chamando fetchDimensoes com delay opcional
    â”‚   â”‚           -> atualiza progresso + tabela
    â”‚   â”‚   â€¢ UI:
    â”‚   â”‚       - renderTabela()
    â”‚   â”‚           -> monta <tbody> com #, MLB, altura, largura, comprimento, peso, raw, status
    â”‚   â”‚       - atualizarProgresso(atual, total)
    â”‚   â”‚       - exportarCSV()
    â”‚   â”‚           -> gera CSV com:
    â”‚   â”‚              MLB;Altura_cm;Largura_cm;Comprimento_cm;Peso_g;Bruto_shipping_dimensions;Status
    â”‚   â”‚   â€¢ eventos:
    â”‚   â”‚       - click em #btn-dim-analisar-um      -> processa um MLB
    â”‚   â”‚       - click em #btn-dim-analisar-lote    -> processa lista de MLBs
    â”‚   â”‚       - click em #btn-dim-download         -> baixa CSV
    â”‚   â”‚       - click em #btn-status               -> abre modal de token e chama verificarToken(true)
    â”‚   â”‚       - click em #account-switch           -> trocarConta()
    â”‚   â”‚       - handlers data-action="verificar-token" / "renovar-token" no modal
    â”‚   â”‚       - listener pra fechar o modal clicando fora
    â”‚   â”‚       - DOMContentLoaded -> carregarContaAtual() + bindEvents()
    â”‚   â”‚
    â”‚   â””â”€ ... outros .js (analise-anuncio.js, ia-analytics-curva-abc.js, etc.)
    â”‚
    â”œâ”€ css/
    â”‚   â”œâ”€ validar-dimensoes.css          # (separado) estilos especÃ­ficos da tela
    â”‚   â”‚   â€¢ layout dos cards
    â”‚   â”‚   â€¢ grid dos inputs
    â”‚   â”‚   â€¢ tabela de resultados
    â”‚   â”‚   â€¢ barra de progresso
    â”‚   â”‚
    â”‚   â”œâ”€ dashboard.css                  # estilos globais (header, abas, etc.)
    â”‚   â””â”€ ... outros CSS
    â”‚
    â””â”€ img/
        â””â”€ ...                            # se tiver Ã­cones/ilustraÃ§Ãµes especÃ­ficas
