MAPEAMENTO ATUALIZADO (TXT) â€” DAVANTTI API
VersÃ£o: 2026-01-13 (inclui nova feature â€œAnalise IA / AnÃ¡lise de AnÃºncioâ€)
Obs: este documento substitui o seu mapeamento anterior, mantendo o mesmo â€œestiloâ€ e adicionando/ajustando:
- OAuth Mercado Livre (PKCE + state no DB) + seleÃ§Ã£o de conta (cookie httpOnly meli_conta_id)
- Multi-empresa (empresas + empresa_usuarios) e modo MASTER (admin_master) com listagem global
- Admin Panel (telas em /admin/*) com sidebar Ãºnica e pÃ¡ginas CRUD por tabela
- MigraÃ§Ãµes (db/migrate.js) com tabela migracoes para histÃ³rico
- Backup (export/import JSON) em /admin/backup (MASTER ONLY)

âœ… NOVA MODIFICAÃ‡ÃƒO (2025-12-29)
- NOVO middleware: middleware/ensurePermission.js
  â€¢ nÃ­veis atuais: padrao | admin | master (master == admin_master)
  â€¢ permite reutilizar gates admin-only e master-only em qualquer rota HTML/API
  â€¢ HTML (GET): redirect /nao-autorizado
  â€¢ API/fetch: 403 JSON { ok:false, error, redirect:'/nao-autorizado' }

- ProteÃ§Ã£o adicional da VIEW (HTML) de exclusÃ£o:
  â€¢ GET /excluir-anuncio (htmlRoutes) agora usa ensurePermission.requireAdmin()
    -> usuÃ¡rio padrao ao clicar no card serÃ¡ redirecionado para /nao-autorizado

- API de exclusÃ£o continua protegida no prefixo:
  â€¢ app.use('/api/excluir-anuncio', ensurePermission.requireAdmin(), excluirAnuncioRoutes)

================================================================================
1) Publicidade/Product ADS
================================================================================

/ (raiz do projeto)
â”œâ”€ index.js
â”‚  â””â”€ registra routes/publicidadeRoutes.js
â”‚
â”œâ”€ routes/
â”‚  â”œâ”€ publicidadeRoutes.js
â”‚  â”‚  â€¢ GET /publicidade                               -> abre a tela (view)
â”‚  â”‚  â€¢ GET /api/publicidade/product-ads/campaigns
â”‚  â”‚  â€¢ GET /api/publicidade/product-ads/campaigns/:id/items
â”‚  â”‚  â€¢ GET /api/publicidade/product-ads/metricas-diarias
â”‚  â”‚  â””â”€ chama PublicidadeController
â”‚  â””â”€ ...
â”‚
â”œâ”€ controllers/
â”‚  â”œâ”€ PublicidadeController.js
â”‚  â”‚  â€¢ listarCampanhas(req,res)       -> ProductAdsService.listarCampanhas()
â”‚  â”‚  â€¢ listarItensCampanha(req,res)   -> ProductAdsService.listarItensCampanha()
â”‚  â”‚  â€¢ metricasDiarias(req,res)       -> ProductAdsService.metricasDiarias()
â”‚  â”‚  â””â”€ responde JSON para o front
â”‚  â””â”€ ...
â”‚
â”œâ”€ services/
â”‚  â”œâ”€ productAdsService.js             # lÃ³gica completa de Product Ads
â”‚  â””â”€ tokenService.js / ml-auth.js     # suporte de token ML
â”‚
â”œâ”€ views/
â”‚  â”œâ”€ publicidade.ejs                  # Tela â€œPainel de Product Adsâ€
â”‚  â””â”€ ...
â”‚
â””â”€ public/
   â”œâ”€ js/publicidade.js
   â””â”€ css/publicidade.css + css globais

================================================================================
2) Produtos / Validar dimensÃµes
================================================================================

/ (raiz do projeto)
â”œâ”€ index.js
â”‚  â”œâ”€ app.use(routes/validarDimensoesRoutes.js)
â”‚  â””â”€ GET /validar-dimensoes -> view HTML
â”‚
â”œâ”€ routes/
â”‚  â””â”€ validarDimensoesRoutes.js
â”‚     â€¢ POST /api/validar-dimensoes/analisar-item -> ValidarDimensoesController.analisarItem()
â”‚
â”œâ”€ controllers/
â”‚  â””â”€ ValidarDimensoesController.js
â”‚     â€¢ analisarItem(req,res) -> ValidarDimensoesService.analisarUm(mlb, opts)
â”‚
â”œâ”€ services/
â”‚  â””â”€ validarDimensoesService.js
â”‚     â€¢ authFetch c/ renovaÃ§Ã£o (TokenService)
â”‚     â€¢ parseDimensions()
â”‚     â€¢ analisarUm()
â”‚
â”œâ”€ views/
â”‚  â””â”€ validar-dimensoes.html
â”‚
â””â”€ public/
   â”œâ”€ js/validar-dimensoes.js
   â””â”€ css/validar-dimensoes.css (+ dashboard.css)

===============================================================================
3) Produtos EstratÃ©gicos (PreÃ§o Original / PreÃ§o Promo / % calculada no FRONT)
===============================================================================

/ (raiz do projeto)
â”œâ”€ index.js
â”‚ â”œâ”€ app.use(estrategicosRoutes)
â”‚ â””â”€ GET /estrategicos
â”‚ -> views/estrategicos.html
â”‚ -> carrega /js/estrategicos.js + /css/estrategicos.css
â”‚
â”œâ”€ routes/estrategicosRoutes.js
â”‚ â”œâ”€ (opcional) middleware de conta:
â”‚ â”‚ â€¢ ensureAccount (cookie meli_conta_id) -> res.locals.mlCreds.meli_conta_id + access_token
â”‚ â”‚
â”‚ â”œâ”€ LISTA / CRUD
â”‚ â”‚ â€¢ GET /api/estrategicos -> EstrategicosController.list
â”‚ â”‚ â€¢ POST /api/estrategicos -> EstrategicosController.upsert (409 DUPLICATE_MLB)
â”‚ â”‚ â€¢ PUT /api/estrategicos/:id -> EstrategicosController.update (atualiza sÃ³ promo_price)
â”‚ â”‚ â€¢ DELETE /api/estrategicos/:mlb -> EstrategicosController.remove (compat por MLB)
â”‚ â”‚ â€¢ DELETE /api/estrategicos/id/:id -> EstrategicosController.removeById
â”‚ â”‚
â”‚ â”œâ”€ IMPORT/REPLACE (CSV)
â”‚ â”‚ â€¢ POST /api/estrategicos/replace -> EstrategicosController.replace
â”‚ â”‚ -> insere apenas novos (report.skipped_existing)
â”‚ â”‚ -> remove_missing (opcional)
â”‚ â”‚
â”‚ â”œâ”€ SYNC (Atualizar do Mercado Livre)
â”‚ â”‚ â€¢ POST /api/estrategicos/:mlb/sync -> EstrategicosController.syncByMlb
â”‚ â”‚ â€¢ POST /api/estrategicos/id/:id/sync -> EstrategicosController.syncOne
â”‚ â”‚ â€¢ POST /api/estrategicos/sync -> EstrategicosController.syncAll (opcional ids/limit)
â”‚ â”‚ -> busca item no ML + Prices API
â”‚ â”‚ -> atualiza: name, listing_status, original_price, percent_applied, status, last_synced_at
â”‚ â”‚
â”‚ â”œâ”€ APLICAR PROMOÃ‡ÃƒO
â”‚ â”‚ â€¢ POST /api/estrategicos/apply -> EstrategicosController.apply
â”‚ â”‚ -> calcula % a aplicar via (original_price do DB) vs (promo_price enviado)
â”‚ â”‚ -> CriarPromocaoService.aplicarDescontoUnico(mlb, percent)
â”‚ â”‚ -> atualiza DB: promo_price, percent_applied (quando sucesso), status
â”‚ â”‚
â”‚ â”œâ”€ BULK (Selecionados / Selecionar Todos)
â”‚ â”‚ â€¢ POST /api/estrategicos/bulk/sync -> EstrategicosController.bulkSync { all?/ids?/mlbs?/limit? }
â”‚ â”‚ â€¢ POST /api/estrategicos/bulk/delete -> EstrategicosController.bulkDelete { all?/confirm_all?/ids?/mlbs? }
â”‚ â”‚ -> proteÃ§Ã£o: all exige confirm_all
â”‚
â”œâ”€ controllers/EstrategicosController.js
â”‚ â”œâ”€ DB: tabela anuncios_estrategicos (por meli_conta_id)
â”‚ â”œâ”€ Helpers:
â”‚ â”‚ â€¢ ensureContaId(res) / getAccessToken(req,res)
â”‚ â”‚ â€¢ fetchItemBasics() -> GET /items/{mlb}?attributes=...
â”‚ â”‚ â€¢ fetchPromoFromPricesApi() -> GET /items/{mlb}/prices
â”‚ â”‚ â€¢ syncAndPersistOne() -> persiste name/status/original_price/percent_applied...
â”‚ â”‚
â”‚ â”œâ”€ Endpoints:
â”‚ â”‚ â€¢ list / upsert / update / remove / removeById
â”‚ â”‚ â€¢ replace (insere novos + report)
â”‚ â”‚ â€¢ syncByMlb / syncOne / syncAll
â”‚ â”‚ â€¢ apply (calcula % e chama CriarPromocaoService)
â”‚ â”‚ â€¢ bulkSync / bulkDelete
â”‚
â”œâ”€ services/criarPromocaoService.js
â”‚ â””â”€ aplicarDescontoUnico(mlb, percentToApply, options)
â”‚
â”œâ”€ views/estrategicos.html
â”‚ â”œâ”€ Tabela com checkbox por linha + checkbox no header (seleciona sÃ³ a pÃ¡gina)
â”‚ â”œâ”€ AÃ§Ãµes: Selecionar todos (global) / Limpar / Atualizar selecionados / Aplicar / Excluir
â”‚ â”œâ”€ NOVO: (planejado) campo de busca por MLB
â”‚ â””â”€ DOM ids principais:
â”‚ tbodyStrategicos, chkSelectAllRows, btnSelectAllGlobal, btnClearSelection,
â”‚ btnSyncSelected, btnDeleteSelected, btnApplySelected, summarySelected, summaryTotal
â”‚
â””â”€ public/css/estrategicos.css
â””â”€ AJUSTE: nome do produto pode virar 2 linhas (line-clamp: 2) para reduzir corte e abrir espaÃ§o
â””â”€ public/js/estrategicos.js
â”œâ”€ loadRows() -> GET /api/estrategicos -> renderTable()
â”œâ”€ SeleÃ§Ã£o:
â”‚ â€¢ checkbox header = pÃ¡gina
â”‚ â€¢ Selecionar todos global = selectedAll + excludedMlbs
â”œâ”€ computePct(original, promo) -> % calculada (somente UI)
â”œâ”€ Linha:
â”‚ â€¢ saveRow -> PUT /api/estrategicos/:id
â”‚ â€¢ syncRow -> POST /api/estrategicos/:mlb/sync (fallback id)
â”‚ â€¢ deleteRow -> DELETE /api/estrategicos/:mlb
â”œâ”€ Bulk:
â”‚ â€¢ handleSyncSelected -> POST /api/estrategicos/bulk/sync
â”‚ â€¢ handleDeleteSelected -> POST /api/estrategicos/bulk/delete
â”‚ â€¢ handleApplySelected -> POST /api/estrategicos/apply { items:[{mlb,promo_price}] }
â””â”€ Import CSV:
â€¢ handleUploadProcess() -> POST /api/estrategicos/replace

================================================================================
4) Curva ABC (tempo real via API Mercado Livre)
================================================================================

/ (raiz do projeto)
â”œâ”€ index.js
â”‚  â”œâ”€ app.use('/api/analytics', analyticsAbcRoutes)
â”‚  â””â”€ GET /ia-analytics/curva-abc -> view
â”‚
â”œâ”€ routes/analytics-abc-routes.js
â”‚  â€¢ GET /api/analytics/abc-ml/summary
â”‚  â€¢ GET /api/analytics/abc-ml/items
â”‚
â”œâ”€ views/ia-analytics/curva-abc.html
â””â”€ public/js/ia-analytics-curva-abc.js + public/css/curva-abc.css

================================================================================
5) ExclusÃ£o de AnÃºncios (Ãºnico + lote, com painel de processos)
================================================================================

/ (raiz do projeto)
â”œâ”€ index.js
â”‚  â”œâ”€ âœ… MODIFICADO: gate por permissÃ£o (ADMIN|MASTER)
â”‚  â”‚  â€¢ app.use('/api/excluir-anuncio', ensurePermission.requireAdmin(), excluirAnuncioRoutes)
â”‚  â”‚
â”‚  â””â”€ âœ… MODIFICADO: VIEW HTML tambÃ©m protegida (via htmlRoutes)
â”‚     â€¢ GET /excluir-anuncio -> views/excluir-anuncio.html (via htmlRoutes + ensurePermission.requireAdmin())
â”‚
â”œâ”€ routes/excluirAnuncioRoutes.js
â”‚  â€¢ DELETE /anuncios/excluir/:mlb_id
â”‚  â€¢ POST   /anuncios/excluir-lote
â”‚  â€¢ GET    /anuncios/status-exclusao/:id
â”‚
â”œâ”€ controllers/ExcluirAnuncioController.js
â”‚  â€¢ excluirUnico / excluirLote / status
â”‚
â”œâ”€ services/excluirAnuncioService.js
â”‚  â€¢ excluirUnico() / excluirLote() com authFetch + TokenService
â”‚
â”œâ”€ views/excluir-anuncio.html
â””â”€ public/js/excluir-anuncio.js + exclusao-bulk.js + jobs-panel.js

================================================================================
6) Filtro AvanÃ§ado de AnÃºncios (COM JOBS)
================================================================================

/ (raiz do projeto)
â”œâ”€ index.js
â”‚  â”œâ”€ app.use('/api/analytics', analyticsFiltroAnunciosRoutes)
â”‚  â””â”€ GET /filtro-anuncios -> views/filtro-anuncios.html
â”‚
â”œâ”€ routes/analytics-filtro-anuncios-routes.js
â”‚  â€¢ POST /api/analytics/filtro-anuncios/jobs
â”‚  â€¢ GET  /api/analytics/filtro-anuncios/jobs/:job_id
â”‚  â€¢ GET  /api/analytics/filtro-anuncios/jobs/:job_id/items
â”‚  â€¢ GET  /api/analytics/filtro-anuncios/jobs/:job_id/download.csv
â”‚
â”œâ”€ services/filtroAnunciosQueueService.js (Bull + Redis)
â””â”€ public/js/filtro-anuncios.js + views/filtro-anuncios.html

================================================================================
7) Login (JWT do app) + AutorizaÃ§Ã£o (Admin/Master)
================================================================================

/ (raiz do projeto)
â”œâ”€ index.js
â”‚  â”œâ”€ Rotas pÃºblicas:
â”‚  â”‚  â€¢ GET /selecao-plataforma -> views/selecao-plataforma.html
â”‚  â”‚  â€¢ GET /login             -> views/login.html
â”‚  â”‚  â€¢ app.use('/api/auth', authRoutes)
â”‚  â”‚
â”‚  â”œâ”€ app.use(ensureAuth)  # âœ… abaixo exige login (cookie auth_token)
â”‚  â”‚
â”‚  â”œâ”€ GET /select-conta      -> views/select-conta.html
â”‚  â”œâ”€ GET /vincular-conta    -> views/vincular-conta.html
â”‚  â”œâ”€ GET /nao-autorizado    -> pÃ¡gina 403
â”‚  â”‚
â”‚  â”œâ”€ (Admin HTML) /admin/*  -> gate MASTER (admin_master)
â”‚  â””â”€ (App) app.use(ensureAccount) -> exige conta ML selecionada (meli_conta_id)
â”‚
â”œâ”€ routes/authRoutes.js
â”‚  â€¢ POST /api/auth/login
â”‚  â€¢ POST /api/auth/logout
â”‚  â€¢ GET  /api/auth/me
â”‚
â”œâ”€ middleware/ensureAuth.js
â”‚  â€¢ valida JWT do cookie auth_token
â”‚  â€¢ injeta req.user/res.locals.user
â”‚  â€¢ HTML: redirect /login
â”‚  â€¢ API: 401 JSON (ou via ensureAuthApi)
â”‚
â””â”€ tabelas base:
   â€¢ usuarios(id, nome, email, senha_hash, nivel, criado_em, ultimo_login_em)
   â€¢ niveis: usuario | admin | admin_master (MASTER)

FULL â€¢ Produtos Fulfillment (ATUAL)
(sem alteraÃ§Ãµes)

================================================================================
8) SISTEMA NOVO â€” OAuth Mercado Livre + SeleÃ§Ã£o de Conta (novo fluxo)
================================================================================
(sem alteraÃ§Ãµes, mantÃ©m a seÃ§Ã£o inteira como estÃ¡ no seu texto)
- ensureAuth -> ensureAccount -> authMiddleware -> rotas protegidas

================================================================================
9) Select Conta (frontend) â€” modo MASTER + paginaÃ§Ã£o/filtros
================================================================================
(sem alteraÃ§Ãµes)

================================================================================
10) Criar PromoÃ§Ã£o (Central de PromoÃ§Ãµes + aplicar/remover + jobs)
================================================================================
(sem alteraÃ§Ãµes)

================================================================================
11) âœ… NOVO â€” Analise IA (IA â€¢ AnÃ¡lise de AnÃºncio) â€” OVERVIEW + DependÃªncias
================================================================================

Objetivo
Tela â€œIA â€¢ AnÃ¡lise de AnÃºncioâ€ no padrÃ£o do EDITAR/Full:
â€¢ input MLB (pega o primeiro MLB de um texto colado)
â€¢ janela de dias (7/30/60/90 ou livre via select)
â€¢ CEP opcional para simular frete
â€¢ bloco â€œBuscar anÃºncio + Foto do produtoâ€ (grid 2 colunas)
â€¢ â€œInformaÃ§Ãµesâ€ unifica Resumo + detalhes (mini-kpis + kv)
â€¢ tabs internas: Detalhes | DiagnÃ³stico | JSON
â€¢ copiar JSON (topo e tambÃ©m na aba JSON)
â€¢ tudo protegido (ninguÃ©m acessa sem estar logado + conta selecionada + token ML vÃ¡lido)

ProteÃ§Ãµes (padrÃ£o do seu index.js)
âœ… ensureAuth (JWT do app) aplicado globalmente abaixo das rotas pÃºblicas mÃ­nimas
âœ… ensureAccount (conta ML selecionada via cookie meli_conta_id)
âœ… authMiddleware (token ML vÃ¡lido/renovÃ¡vel) para rotas do app

ObservaÃ§Ã£o
Como o htmlRoutes estÃ¡ montado DEPOIS do ensureAccount + authMiddleware,
a pÃ¡gina /analise-ia tambÃ©m exige conta selecionada e token ML (alÃ©m do login JWT).

/ (raiz do projeto)
â”œâ”€ index.js
â”‚ â”œâ”€ (PÃšBLICO mÃ­nimo)
â”‚ â”‚ â€¢ GET /selecao-plataforma
â”‚ â”‚ â€¢ GET /login
â”‚ â”‚ â€¢ GET /cadastro
â”‚ â”‚ â€¢ GET /nao-autorizado
â”‚ â”‚ â€¢ GET /api/system/health (healthcheck deploy)
â”‚ â”‚ â€¢ /api/auth/* (login/logout/me)
â”‚ â”‚
â”‚ â”œâ”€ (ğŸ”’ A PARTIR DAQUI: exige JWT)
â”‚ â”‚ â€¢ app.use(ensureAuth)
â”‚ â”‚
â”‚ â”œâ”€ (OAuth ML / seleÃ§Ã£o de conta â€” ainda dentro do JWT)
â”‚ â”‚ â€¢ /api/meli/* (vincular contas)
â”‚ â”‚ â€¢ GET /select-conta
â”‚ â”‚ â€¢ /api/account/*
â”‚ â”‚
â”‚ â”œâ”€ (ğŸ”’ Exigir conta selecionada)
â”‚ â”‚ â€¢ app.use(ensureAccount)
â”‚ â”‚
â”‚ â”œâ”€ (ğŸ”’ Exigir token ML vÃ¡lido)
â”‚ â”‚ â€¢ app.use(authMiddleware)
â”‚ â”‚
â”‚ â”œâ”€ (HTML da feature)
â”‚ â”‚ â€¢ montado via htmlRoutes
â”‚ â”‚ â€¢ GET /analise-ia -> views/analise-ia.html
â”‚ â”‚
â”‚ â””â”€ (API da feature)
â”‚ â€¢ app.use('/api/analise-anuncios', AnaliseAnuncioRoutes)
â”‚ -> OBS: manter esse nome /api/analise-anuncios mesmo que a tela se chame /analise-ia (UI),
â”‚ para evitar colisÃ£o com outras features.

Arquivos principais e dependentes
â”œâ”€ routes/AnaliseAnuncioRoutes.js âœ…
â”‚ â€¢ router.use(Cache-Control: no-store)
â”‚ â€¢ GET /api/analise-anuncios/overview/:mlb
â”‚   - query: days=30 (default), zip_code=xxxxx-xxx (opcional)
â”‚   - chama AnaliseAnuncioController.overview()
â”‚ â€¢ GET /api/analise-anuncios/ping
â”‚ â€¢ GET /api/analise-anuncios/routes (debug)
â”‚   - se middleware/ensurePermission.js existir:
â”‚     protege com ensurePermission.requireMaster()
â”‚   - senÃ£o: sÃ³ expÃµe fora de produÃ§Ã£o
â”‚
â”œâ”€ controllers/AnaliseAnuncioController.js âœ…
â”‚ â€¢ overview(req,res)
â”‚   - valida mlb (MLB\d+)
â”‚   - lÃª days (1..365) e zip_code (opcional)
â”‚   - exige accessToken via req.ml.accessToken (injetado pelo authMiddleware)
â”‚   - chama analiseAnuncioService.getOverview({ mlb, accessToken, days, zip_code })
â”‚   - retorna { ok:true, ...data } ou { ok:false, error, message }
â”‚
â”œâ”€ services/analiseAnuncioService.js âœ…
â”‚ â€¢ getOverview({ mlb, accessToken, days, zip_code })
â”‚ - chama endpoints oficiais do Mercado Livre:
â”‚   1) GET /items/:mlb
â”‚   2) visitas (fallbacks):
â”‚      - GET /items/:mlb/visits?date_from=...&date_to=...
â”‚      - GET /visits/items?ids=:mlb&date_from=...&date_to=...
â”‚      - GET /visits/items?ids=:mlb (fallback simples)
â”‚   3) frete (se zip_code informado):
â”‚      - GET /items/:mlb/shipping_options?zip_code=...
â”‚      - (fallback) /items/:mlb/shipping_options/free?zip_code=...
â”‚   4) vendedor:
â”‚      - GET /users/:seller_id
â”‚
â”‚ - NormalizaÃ§Ãµes do retorno:
â”‚   â€¢ is_premium = listing_type_id == gold_pro (ou gold_premium)
â”‚   â€¢ seller.location = cidade/estado (quando disponÃ­vel)
â”‚   â€¢ shipping.cost = menor custo encontrado nas opÃ§Ãµes
â”‚
â”‚ - âœ… Foto nÃ­tida (evitar thumb borrada):
â”‚   â€¢ pictures[] vem de item.pictures[].secure_url/url
â”‚   â€¢ thumbnail prioriza pictures[0] e cai em item.thumbnail como fallback
â”‚
â”‚ - Retorno consolidado esperado pelo front:
â”‚   {
â”‚     ok: true,
â”‚     summary: { id,title,status,permalink,category_id,condition,currency_id,
â”‚               price,available_quantity,sold_quantity,
â”‚               listing_type_id,catalog_listing,is_premium,
â”‚               date_created,last_updated,thumbnail,pictures[] },
â”‚     visits: { total,date_from,date_to },
â”‚     shipping: { zip_code,free_shipping,cost,logistic_type,mode },
â”‚     seller: { seller_id,nickname,location, (opcional) official_store_id/official_store },
â”‚     seller_reputation: { level_id,power_seller_status,transactions,metrics... },
â”‚     meta: { fetched_at },
â”‚     raw: { item,seller,visits,shipping }
â”‚   }
â”‚
â”œâ”€ routes/htmlRoutes.js âœ…
â”‚ â€¢ GET /analise-ia -> views/analise-ia.html
â”‚
â”œâ”€ views/analise-ia.html âœ…
â”‚ â€¢ Layout: mesmo padrÃ£o do editar (top header + chips + card-panel)
â”‚ â€¢ Card principal:
â”‚   - Coluna esquerda: MLB + janela dias + CEP + botÃµes
â”‚   - Coluna direita: Foto do produto (bloco fixo)
â”‚ â€¢ Bloco â€œInformaÃ§Ãµesâ€ unificado:
â”‚   - mini-kpis (Resumo)
â”‚   - lista kv (detalhes)
â”‚ â€¢ Tabs internas:
â”‚   - Detalhes
â”‚   - DiagnÃ³stico
â”‚   - JSON (<pre> + copiar)
â”‚
â””â”€ public/
   â”œâ”€ js/analise-ia.js âœ…
   â”‚ â€¢ API_BASE = /api/analise-anuncios
   â”‚ â€¢ loadOverview() -> GET /overview/:mlb?days=&zip_code=
   â”‚ â€¢ parseFirstMlb(): pega o 1Âº MLB encontrado em texto colado
   â”‚ â€¢ render:
   â”‚   - renderSummary() (mini-kpis + pills + KPIs)
   â”‚   - renderInfoList() (kv unificado)
   â”‚   - renderPhoto() (usa summary.thumbnail/pictures[0])
   â”‚   - renderDiagnostic()
   â”‚   - renderJson()
   â”‚ â€¢ copiar JSON: btnCopyJson + btnCopyJson2
   â”‚ â€¢ tabs internas: .inner-tab + .pane (padrÃ£o editar)
   â”‚
   â””â”€ css/analise-ia.css âœ…
     â€¢ baseado no editar-anuncio.css (card-panel, chips, inner-tabs, json-pre)
     â€¢ ajustes especÃ­ficos:
       - .aa-search-grid: busca + foto lado a lado
       - .aa-photo-wrap: bloco fixo (nÃ£o â€œexplodeâ€ quando carrega imagem)
       - mini-kpis para resumo
       - aa-kv para pares chave/valor
       - evitar conflito bootstrap: usar .aa-row em vez de .row

Notas de seguranÃ§a/permissÃ£o:
- A tela /analise-ia Ã© â€œapp normalâ€ (nÃ£o admin-only por padrÃ£o).
- ProteÃ§Ã£o vem do pipeline:
  ensureAuth (JWT app) -> ensureAccount (cookie meli_conta_id) -> authMiddleware (token ML vÃ¡lido)
- Se quiser restringir por nÃ­vel, aplicar ensurePermission.requireAdmin() no GET /analise-ia (htmlRoutes).

================================================================================
(SeÃ§Ãµes 1â€“10 permanecem iguais ao seu texto; foi adicionado o item 11 no final)
================================================================================
