<!-- views/estrategicos.html -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Produtos Estrat√©gicos</title>

  <!-- Estilos globais + espec√≠ficos -->
  <link rel="stylesheet" href="/css/dashboard.css?v=2">
  <link rel="stylesheet" href="/css/estrategicos.css?v=2">
</head>
<body>
  <!-- TOPO FIXO (mesmo padr√£o das outras telas) -->
  <header class="account-bar">
    <div class="account-bar__left">
      <a class="brand" href="/dashboard" aria-label="DAVANTTI">
        <img
          src="/img/davantti.png"
          alt="DAVANTTI"
          class="brand__logo"
          width="170"
          height="42"
          decoding="async"
          loading="eager"
        />
      </a>
    </div>

    <div class="account-bar__right">
      <div class="account-bar__current">
        <span class="lbl">Conta:</span>
        <span id="account-current" class="val" data-account-label>Carregando...</span>
      </div>

      <button
        id="btn-status"
        class="account-bar__status"
        title="Ver status do token"
        type="button"
        data-account-status
      >Status</button>

      <button
        id="account-switch"
        class="account-bar__switch"
        title="Trocar de conta"
        type="button"
        data-account-switch
      >Trocar Conta</button>
    </div>
  </header>

  <!-- navegacao com abas -->
  <nav class="main-nav">
    <div class="tabs">
      <button class="nav-tab" onclick="location.href='/dashboard#dashboard'">Dashboard</button>
      <button class="nav-tab active" onclick="location.href='/dashboard#produtos'">Produtos</button>
      <button class="nav-tab" onclick="location.href='/dashboard#ia'">IA & Analytics</button>
      <button class="nav-tab" onclick="location.href='/dashboard#publicidade'">Publicidade</button>
      <button class="nav-tab" onclick="location.href='/dashboard#benchmarking'">Benchmarking</button>
      <button class="nav-tab" onclick="location.href='/dashboard#alertas'">Alertas</button>
      <button class="nav-tab" onclick="location.href='/dashboard#ml'">ML</button>
      <button class="nav-tab" onclick="location.href='/dashboard#full'">FULL</button>
      <button class="nav-tab" onclick="location.href='/dashboard#admin'">Admin</button>
    </div>
  </nav>

  <div class="wrap estrategicos-wrap">
    <!-- CABE√áALHO DA P√ÅGINA -->
    <header class="page-header estrategicos-header">
      <div>
        <h2>Produtos Estrat√©gicos</h2>
        <p class="subtitle">
          Gerencie a lista por conta e defina <strong>Pre√ßo Promo</strong>. O sistema calcula a <strong>%</strong>
          automaticamente a partir do <strong>Pre√ßo Original</strong> do an√∫ncio.
        </p>
      </div>

      <!-- Controles principais -->
      <div class="estrategicos-header__actions">
        <div class="estrategicos-header__group">
          <label for="strategicGroup">Lista de estrat√©gicos</label>
          <select id="strategicGroup">
            <option value="drossi">DRossi Interiores</option>
            <option value="diplany">Diplany</option>
            <option value="rossidecor">Rossi Decor</option>
          </select>
        </div>

        <button id="btnAddRow" type="button" class="btn secondary">
          ‚ûï Adicionar item
        </button>

        <button id="btnToggleUpload" type="button" class="btn ghost">
          ‚¨ÜÔ∏è Atualizar por arquivo
        </button>
      </div>
    </header>

    <!-- ================= LOTE DE MLBS ================= -->
    <section id="addMlbsPanel" class="card estrategicos-add-panel" hidden>
      <header class="card-header">
        <div>
          <h3>Lote de MLBs</h3>
          <p class="muted">
            Cole abaixo um ou mais <strong>MLBs</strong>, um por linha (ou separados por espa√ßo / v√≠rgula).<br>
            O sistema valida duplicados e n√£o insere MLB que j√° exista na lista.
          </p>
        </div>
      </header>

      <div class="estrategicos-add-panel__body">
        <label for="txtAddMlbs" class="estrategicos-add-panel__label">MLBs</label>
        <textarea
          id="txtAddMlbs"
          class="estrategicos-add-panel__textarea"
          rows="6"
          placeholder="MLB123456789&#10;MLB987654321&#10;MLB000000001"
        ></textarea>

        <div class="estrategicos-add-panel__actions">
          <button id="btnAddMlbsConfirm" type="button" class="btn primary">
            ‚ûï Adicionar √† lista
          </button>
          <button id="btnAddMlbsCancel" type="button" class="btn ghost">
            Cancelar
          </button>
        </div>

        <p id="addMlbsStatus" class="muted"></p>
      </div>
    </section>

    <!-- UPLOAD CSV/XLSX -->
    <section id="uploadPanel" class="card estrategicos-upload" hidden>
      <header class="card-header">
        <div>
          <h3>Atualizar Estrat√©gicos por Arquivo</h3>
          <p class="muted">
            Envie um arquivo <strong>CSV</strong> com as colunas <code>mlb</code> e <code>promo_price</code> (pre√ßo final desejado).
            Itens j√° existentes ser√£o ignorados e listados no relat√≥rio ao final.
          </p>
        </div>
      </header>

      <div class="estrategicos-upload__body">
        <div class="estrategicos-upload__field">
          <label for="fileStrategicos">Arquivo (.csv)</label>
          <input id="fileStrategicos" type="file" accept=".csv,.xls,.xlsx" />
          <small class="muted">Exemplo CSV: <code>MLB123;199.90</code></small>
        </div>

        <div class="estrategicos-upload__field inline">
          <label>
            <input id="chkRemoveMissing" type="checkbox" />
            Remover itens que n√£o estiverem no arquivo
          </label>
        </div>

        <div class="estrategicos-upload__actions">
          <button id="btnProcessFile" class="btn primary" type="button">
            üîÑ Processar arquivo
          </button>
          <button id="btnCloseUpload" class="btn ghost" type="button">
            Fechar
          </button>
        </div>

        <p id="uploadStatus" class="muted"></p>
      </div>
    </section>

    <!-- CONTROLES DO CICLO -->
    <section class="card estrategicos-controls">
      <header class="card-header estrategicos-controls__header">
        <div>
          <h3>Configura√ß√£o do ciclo atual</h3>
          <p class="muted">
            Defina um <strong>Pre√ßo Promo</strong> global e preencha nos itens. A % √© calculada automaticamente (n√£o edit√°vel).
          </p>
        </div>
      </header>

      <div class="estrategicos-controls__body">
        <div class="estrategicos-controls__group">
          <label for="promoGlobal">Pre√ßo Promo global (R$)</label>
          <div class="estrategicos-controls__inline">
            <input id="promoGlobal" type="number" min="0" step="0.01" placeholder="ex.: 199.90" />
            <button id="btnFillPromoFromGlobal" type="button" class="btn secondary">
              Preencher coluna ‚ÄúPre√ßo Promo‚Äù
            </button>
          </div>
          <small class="muted">
            Essa a√ß√£o s√≥ preenche a coluna. A promo√ß√£o s√≥ √© criada ao clicar em <strong>Aplicar promo√ß√£o</strong>.
          </small>
        </div>

        <div class="estrategicos-controls__group">
          <label for="promotionType">Tipo de campanha</label>
          <select id="promotionType">
            <option value="DEAL">DEAL / Seller Campaign</option>
            <option value="SMART">SMART</option>
            <option value="PRICE_MATCHING">Price Matching</option>
            <option value="MARKETPLACE_CAMPAIGN">Marketplace Campaign</option>
          </select>
          <small class="muted">
            Esse tipo ser√° utilizado quando o sistema criar as promo√ß√µes.
          </small>
        </div>

        <!-- A√ß√µes em lote -->
        <div class="estrategicos-controls__group apply-actions">
          <button id="btnSelectAllPages" class="btn secondary" type="button" title="Seleciona todos os itens da lista (todas as p√°ginas)">
            ‚úÖ Selecionar todos
          </button>

          <button id="btnClearSelection" class="btn ghost" type="button" title="Limpa a sele√ß√£o">
            Limpar sele√ß√£o
          </button>

          <button id="btnSyncSelected" class="btn secondary" type="button" title="Atualiza do ML os itens selecionados">
            üîÑ Atualizar selecionados
          </button>

          <button id="btnApplySelected" class="btn primary" type="button">
            üöÄ Aplicar promo√ß√£o nos selecionados
          </button>

          <button id="btnDeleteSelected" class="btn danger" type="button">
            üóë Excluir selecionados
          </button>

          <span id="applyHint" class="muted">
            Selecione itens na tabela (p√°gina atual) ou clique em <strong>Selecionar todos</strong>.
          </span>

          <!-- Barra de progresso (lote / bulk) -->
          <div id="bulkAddProgress" class="estrategicos-progress" hidden>
            <div class="estrategicos-progress__bar">
              <div id="bulkAddProgressFill" class="estrategicos-progress__fill"></div>
            </div>
            <div id="bulkAddProgressLabel" class="estrategicos-progress__label">
              0 / 0
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- TABELA -->
    <section class="card estrategicos-table-card">
      <header class="card-header">
        <div>
          <h3>Lista de produtos estrat√©gicos</h3>
          <p class="muted">
            <strong>Nome</strong> n√£o √© edit√°vel. <strong>Pre√ßo Original</strong> vem do ML. Voc√™ define <strong>Pre√ßo Promo</strong>
            e a <strong>% calculada</strong> aparece automaticamente.
          </p>
        </div>

        <div class="estrategicos-table__summary">
          <span id="summaryTotal">0 itens</span>
          <span id="summarySelected">0 selecionados</span>
        </div>
      </header>

      <div class="table-wrapper table-wrapper--wide">
        <table class="table estrategicos-table" id="tblStrategicos">
          <thead>
            <tr>
              <th style="width:32px;">
                <!-- Este checkbox seleciona apenas a P√ÅGINA atual -->
                <input type="checkbox" id="chkSelectAllRows" title="Seleciona todos da p√°gina atual">
              </th>
              <th>MLB</th>
              <th>Nome do produto</th>
              <th>Pre√ßo Original</th>
              <th>Pre√ßo Promo</th>
              <th>% calculada</th>
              <th>% aplicada atualmente</th>
              <th>Status</th>
              <th style="width:140px;">A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tbodyStrategicos">
            <tr>
              <td colspan="9" class="muted">
                Nenhum produto estrat√©gico cadastrado. Use <strong>‚ÄúAdicionar item‚Äù</strong> ou
                <strong>‚ÄúAtualizar por arquivo‚Äù</strong>.
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagina√ß√£o -->
      <div id="strategicPagination" class="strategic-pagination"></div>
    </section>
  </div>

  <!-- Scripts globais -->
  <script src="/js/account-bar.js" defer></script>
  <!-- Script espec√≠fico -->
  <script src="/js/estrategicos.js" defer></script>
</body>
</html>
