<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Publicidade ‚Ä¢ Product Ads</title>

  <!-- Reaproveita estilos globais -->
  <link rel="stylesheet" href="/css/dashboard.css?v=2">
  <link rel="stylesheet" href="/css/publicidade.css?v=2">
</head>
<body>
  <!-- TOPO FIXO -->
  <header class="account-bar">
    <div class="account-bar__left">
      <a class="brand" href="/dashboard" aria-label="DAVANTTI">
        <img
          src="/img/davantti.png"
          alt="DAVANTTI"
          class="brand__logo"
          width="170"
          height="42"
          decoding="async"
          loading="eager"
        />
      </a>
    </div>

    <div class="account-bar__right">
      <div class="account-bar__current">
        <span class="lbl">Conta:</span>
        <span id="account-current" class="val" data-account-label>Carregando...</span>
      </div>

      <button id="btn-status" class="account-bar__status" title="Ver status do token" type="button" data-account-status>
        Status
      </button>

      <button id="account-switch" class="account-bar__switch" title="Trocar de conta" type="button" data-account-switch>
        Trocar Conta
      </button>
    </div>
  </header>

<!-- NAV TABS -->
  <nav class="main-nav">
    <div class="tabs">
      <button class="nav-tab" onclick="location.href='/dashboard#dashboard'">Dashboard</button>
      <button class="nav-tab" onclick="location.href='/dashboard#anuncios'">An√∫ncios</button>
      <button class="nav-tab" onclick="location.href='/dashboard#produtos'">Altera√ß√µes Massivas</button>
      <button class="nav-tab" onclick="location.href='/dashboard#ia'">IA & Analytics</button>
      <button class="nav-tab  active" onclick="location.href='/dashboard#publicidade'">Publicidade</button>
      <button class="nav-tab" onclick="location.href='/dashboard#benchmarking'">Benchmarking</button>
      <button class="nav-tab" onclick="location.href='/dashboard#alertas'">Alertas</button>
      <button class="nav-tab" onclick="location.href='/dashboard#ml'">ML</button>
      <button class="nav-tab" onclick="location.href='/full'">FULL</button>
      <button class="nav-tab" onclick="location.href='/dashboard#admin'">Admin</button>
    </div>
  </nav>

  <div class="wrap publicidade-wrap">

    <!-- ‚úÖ NOVA SE√á√ÉO PREMIUM (substitui cards + gr√°fico antigos) -->
    <section class="ads-premium">

      <div class="ads-premium__top">
        <div>
          <h2 class="ads-premium__title">üìä Vis√£o consolidada</h2>
          <p class="ads-premium__subtitle">
            Gr√°fico di√°rio (X = dias do m√™s) com valores no topo de cada ponto.
          </p>
        </div>
        <!-- ‚úÖ IMPORTANTE: id √∫nico (evita conflito com o ranking abaixo) -->
        <div class="ads-premium__hint" id="premiumPeriod">Per√≠odo: ‚Äî</div>
      </div>

      <div class="ads-premium__panel">
        <!-- filtros -->
        <form id="ads-filters" class="ads-premium__filters">
          <div class="ads-field">
            <label for="dateFrom">Data inicial</label>
            <input id="dateFrom" type="date" />
          </div>

          <div class="ads-field">
            <label for="dateTo">Data final</label>
            <input id="dateTo" type="date" />
          </div>

          <div class="ads-field" style="min-width:220px;">
            <label for="metric">M√©trica do gr√°fico</label>
            <select id="metric">
              <option value="total_amount">Faturamento</option>
              <option value="cost">Investimento</option>
              <option value="clicks">Cliques</option>
              <option value="prints">Impress√µes</option>
            </select>
          </div>

          <div class="ads-actions">
            <button id="btnThisMonth" class="btn-ghost" type="button">üìÖ Este m√™s</button>
            <button id="btnReloadAds" class="btn-premium" type="submit">üîÑ Atualizar</button>
          </div>
        </form>

        <!-- KPIs -->
        <div class="ads-premium__kpis">
          <div class="kpi">
            <div class="kpi-top">
              <div class="kpi-label">Faturamento</div>
              <div class="kpi-pill" id="pillRange">Per√≠odo</div>
            </div>
            <div class="kpi-value" id="kpiRevenue">‚Äî</div>
            <div class="kpi-foot">Total do per√≠odo</div>
          </div>

          <div class="kpi">
            <div class="kpi-top">
              <div class="kpi-label">Investimento</div>
              <div class="kpi-pill">Ads</div>
            </div>
            <div class="kpi-value" id="kpiCost">‚Äî</div>
            <div class="kpi-foot">Total do per√≠odo</div>
          </div>

          <div class="kpi">
            <div class="kpi-top">
              <div class="kpi-label">ROAS</div>
              <div class="kpi-pill">Receita/Invest.</div>
            </div>
            <div class="kpi-value" id="kpiRoas">‚Äî</div>
            <div class="kpi-foot">M√©dia do per√≠odo</div>
          </div>

          <div class="kpi">
            <div class="kpi-top">
              <div class="kpi-label">ACOS</div>
              <div class="kpi-pill">Invest./Receita</div>
            </div>
            <div class="kpi-value" id="kpiAcos">‚Äî</div>
            <div class="kpi-foot">M√©dia do per√≠odo</div>
          </div>

          <div class="kpi">
            <div class="kpi-top">
              <div class="kpi-label">Cliques</div>
              <div class="kpi-pill">Total</div>
            </div>
            <div class="kpi-value" id="kpiClicks">‚Äî</div>
            <div class="kpi-foot">Somat√≥rio</div>
          </div>

          <div class="kpi">
            <div class="kpi-top">
              <div class="kpi-label">Impress√µes</div>
              <div class="kpi-pill">Total</div>
            </div>
            <div class="kpi-value" id="kpiPrints">‚Äî</div>
            <div class="kpi-foot">Somat√≥rio</div>
          </div>

          <div class="kpi">
            <div class="kpi-top">
              <div class="kpi-label">CTR</div>
              <div class="kpi-pill">Cliques/Impr.</div>
            </div>
            <div class="kpi-value" id="kpiCtr">‚Äî</div>
            <div class="kpi-foot">M√©dia do per√≠odo</div>
          </div>

          <div class="kpi">
            <div class="kpi-top">
              <div class="kpi-label">CPC</div>
              <div class="kpi-pill">Invest./Clique</div>
            </div>
            <div class="kpi-value" id="kpiCpc">‚Äî</div>
            <div class="kpi-foot">M√©dia do per√≠odo</div>
          </div>
        </div>

        <!-- gr√°fico + tabela di√°ria -->
        <div class="ads-premium__split">
          <div class="card">
            <div class="card-hd">
              <div>
                <h3 class="card-title">üìà S√©rie di√°ria</h3>
                <div class="card-sub" id="chartHint">X = dias do m√™s ‚Ä¢ Y = valores ‚Ä¢ labels em cada dia</div>
              </div>
              <div class="card-sub">Fonte: /api/publicidade/product-ads/metrics/daily</div>
            </div>
            <div class="card-bd">
              <div class="chart-wrap">
                <!-- mant√©m o id usado pelo JS -->
                <canvas id="adsMetricsChart"></canvas>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-hd">
              <div>
                <h3 class="card-title">üìã Detalhamento di√°rio</h3>
                <div class="card-sub">Resumo por dia (per√≠odo selecionado)</div>
              </div>
              <div class="card-sub" id="tableCount">‚Äî</div>
            </div>
            <div class="card-bd">
              <div class="table-wrap">
                <table class="dash-table">
                  <thead>
                    <tr>
                      <th>Dia</th>
                      <th class="num">Faturamento</th>
                      <th class="num">Investimento</th>
                      <th class="num">Cliques</th>
                      <th class="num">Impress√µes</th>
                      <th class="num">CTR</th>
                      <th class="num">CPC</th>
                      <th class="num">ROAS</th>
                      <th class="num">ACOS</th>
                    </tr>
                  </thead>
                  <tbody id="tbodyDaily">
                    <tr><td colspan="9" class="muted">Carregando‚Ä¶</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- RANKING -->
    <section class="ads-ranking">
      <div class="card">
        <header class="card-header ads-ranking-header">
          <div>
            <h3>Ranking de campanhas</h3>
            <p id="rankingPeriod" class="muted">Per√≠odo: ‚Äî</p>
          </div>
        </header>

        <div class="table-wrapper table-wrapper--wide table-shell">
          <table class="table table-ranking" id="tblCampaigns" data-table="campaigns">
            <thead>
              <tr>
                <th class="sticky-col">Nome da campanha</th>
                <th>Status</th>
                <th>Estrat√©gia</th>
                <th class="num">ACOS objetivo</th>
                <th class="num">ACOS</th>

                <!-- removidas: TACOS, CPI, LISB, LISAR, Participa√ß√£o -->

                <th class="num">Vendas publicidade</th>
                <th class="num">Impress√µes</th>
                <th class="num">Cliques</th>
                <th class="num">Investimento</th>
                <th class="num">CPC</th>
                <th class="num">CTR</th>
                <th class="num">Receita</th>
                <th class="num">Retornos</th>
              </tr>
            </thead>
            <tbody id="tbodyCampaigns">
              <tr>
                <td colspan="13" class="muted">
                  Nenhuma campanha carregada. Clique em <strong>Atualizar m√©tricas</strong>.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- DETALHE -->
    <section class="ads-detail">
      <div class="table-wrapper table-wrapper--wide table-shell ads-items-wrapper">
        <!-- Toolbar (bot√£o Exportar CSV no canto superior direito) -->
        <div class="ads-items-toolbar">
          <div class="ads-items-toolbar__left">
            <strong id="itemsTitle">An√∫ncios da campanha</strong>
            <span id="itemsSubtitle" class="muted">Selecione uma campanha no ranking acima.</span>
          </div>
          <div class="ads-items-toolbar__right">
            <button id="btnExportCsv" type="button" class="btn" disabled>
              Exportar CSV
            </button>
          </div>
        </div>

        <table class="table ads-items-table" id="tblItems">
          <thead>
            <tr>
              <th class="sticky-col">Nome da campanha</th>
              <th>Qualidade da publica√ß√£o</th>

              <!-- ordem solicitada -->
              <th class="num">ACOS</th>
              <th class="num">TACOS</th>
              <th class="num">ROAS</th>

              <th class="num">Impress√µes</th>
              <th class="num">Cliques</th>
              <th class="num">CTR</th>
              <th class="num">CPC</th>

              <th class="num">Convers√£o publicit√°ria</th>
              <th class="num">Vendas publicidade</th>
              <th class="num">Vendas diretas</th>
              <th class="num">Vendas assistidas</th>

              <th class="num">Aporte de publicidade</th>
              <th class="num">Renda por publicidade</th>
              <th class="num">Investimento</th>
            </tr>
          </thead>

          <tbody id="tbodyItems">
            <tr>
              <td colspan="16" class="muted">Nenhuma campanha selecionada.</td>
            </tr>
          </tbody>
        </table>

        <div class="ads-pagination" id="adsPagination"></div>
      </div>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/js/account-bar.js" defer></script>
  <script src="/js/publicidade.js" defer></script>
</body>
</html>
