<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pesquisa em Descri√ß√µes - API Mercado Livre</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- bump de vers√£o para for√ßar recarregar CSS -->
  <link rel="stylesheet" href="/css/pesquisa-descricao.css?v=4">
</head>
<body>
  <div class="page">
    <!-- Topbar -->
    <header class="topbar">
      <div class="topbar__brand">
        <span class="logo">üîé</span>
        <h1>Pesquisa em Descri√ß√µes</h1>
      </div>
      <div class="topbar__actions">
          <a class="btn btn-secondary" href="/">üè† Dashboard</a>
      </div>
    </header>

    <main class="container">
      <!-- Intro -->
      <section class="hero">
        <div class="hero__content">
          <h2>Sistema avan√ßado de pesquisa em massa com processamento inteligente</h2>
          <p>Fa√ßa buscas, processe grandes volumes em background e acompanhe tudo em tempo real.</p>
        </div>
      </section>

      <!-- === SOMENTE as se√ß√µes √∫teis (sem abas e sem Pesquisa R√°pida) === -->

      <!-- Tab: Processamento em Massa -->
      <section id="processamento-massa" class="tab-content active">
        <div class="callout callout-warning">
          <strong>üöÄ Processamento em Massa:</strong> Para lotes grandes (50+). Processamento em background com monitoramento e download.
        </div>

        <div class="grid-2">
          <!-- modos -->
          <div class="card">
            <label class="label">Escolha o Modo de Processamento</label>
            <div class="modes">
              <div class="processing-mode" id="modo-direto" onclick="selecionarModo('direto')">
                <div class="mode__icon">‚ö°</div>
                <div class="mode__content">
                  <h3>Processamento Direto</h3>
                  <p>Resultados na mesma p√°gina. Recomendado at√© 100 MLBs.</p>
                  <div class="tags">
                    <span class="tag">Resultados Imediatos</span>
                    <span class="tag">At√© 100 MLBs</span>
                    <span class="tag">Sem Download</span>
                  </div>
                </div>
              </div>

              <div class="processing-mode" id="modo-background" onclick="selecionarModo('background')">
                <div class="mode__icon">üöÄ</div>
                <div class="mode__content">
                  <h3>Processamento em Background</h3>
                  <p>Fila para grandes volumes. Ideal para milhares de MLBs com download.</p>
                  <div class="tags">
                    <span class="tag">Grandes Volumes</span>
                    <span class="tag">Download</span>
                    <span class="tag">Monitoramento</span>
                    <span class="tag">Sem Limite</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- formul√°rio -->
          <form id="form-processamento-massa" class="card">
            <div class="form-group">
              <label for="tipo-pesquisa-massa">Tipo de Pesquisa</label>
              <select id="tipo-pesquisa-massa" class="form-control" required onchange="alterarTipoPesquisaMassa()">
                <option value="">Selecione o tipo de pesquisa...</option>
                <option value="detectar_dois_volumes">üîç Detectar Produtos com Dois Volumes</option>
                <option value="pesquisar_texto">üìù Pesquisar Texto Espec√≠fico</option>
              </select>
            </div>

            <div id="grupo-texto-massa" class="form-group" style="display:none;">
              <label for="texto-pesquisa-massa">Texto para Pesquisar</label>
              <input type="text" id="texto-pesquisa-massa" class="form-control" placeholder="Digite o texto a ser pesquisado..." />
              <small class="help">O sistema busca em t√≠tulos, descri√ß√µes e atributos.</small>
            </div>

            <div class="form-group">
              <label for="mlbs-massa">MLBs para Processar</label>
              <textarea id="mlbs-massa" class="form-control" rows="10" placeholder="Cole os MLBs aqui, um por linha ou separados por v√≠rgula..." required oninput="contarMLBsMassa()"></textarea>

              <div id="contador-massa" class="counter">
                <div class="counter__items">
                  <div class="chip">
                    <div class="chip__num" id="total-mlbs-massa">0</div>
                    <div class="chip__label">MLBs Detectados</div>
                  </div>
                  <div class="chip">
                    <div class="chip__num" id="validos-mlbs-massa">0</div>
                    <div class="chip__label">V√°lidos</div>
                  </div>
                  <div class="chip">
                    <div class="chip__num" id="invalidos-mlbs-massa">0</div>
                    <div class="chip__label">Inv√°lidos</div>
                  </div>
                  <div class="chip">
                    <div class="chip__num" id="tempo-estimado-massa">0</div>
                    <div class="chip__label">Min. Estimados</div>
                  </div>
                </div>
                <div id="status-processamento-massa" class="pill">Modo: N√£o Selecionado</div>
              </div>
            </div>

            <div class="form-group checkbox">
              <label>
                <input type="checkbox" id="forcar-background-massa" onchange="atualizarModoProcessamento()" />
                üîß For√ßar processamento em background
              </label>
              <small class="help">√ötil para monitorar progresso ou baixar resultados.</small>
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-outline" onclick="limparFormularioMassa()">üóëÔ∏è Limpar</button>
              <button type="button" class="btn btn-secondary" onclick="validarMLBsMassa()">‚úÖ Validar MLBs</button>
              <button type="submit" class="btn btn-primary" id="btn-processar-massa">üöÄ Iniciar Processamento</button>
            </div>
          </form>
        </div>
      </section>

      <!-- Tab: Monitoramento -->
      <section id="monitoramento" class="tab-content">
        <div class="callout callout-info">
          <strong>üìä Monitoramento:</strong> Acompanhe seus processos em tempo real.
        </div>

        <div class="toolbar">
          <button class="btn btn-primary" onclick="atualizarMonitoramento()">üîÑ Atualizar</button>
          <button class="btn btn-success" onclick="abrirModalNovoProcesso()">‚ûï Novo Processo</button>
          <button class="btn btn-warning" onclick="controlarSistema('pausar')" id="btn-pausar-sistema">‚è∏Ô∏è Pausar Sistema</button>
          <button class="btn btn-outline" onclick="window.open('/dashboard','_blank')">üè† Dashboard Principal</button>
        </div>

        <div id="stats-monitoramento" class="stats">
          <div class="stat-card">
            <div class="stat-number" id="stat-processando">0</div>
            <div class="stat-label">Processando</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="stat-aguardando">0</div>
            <div class="stat-label">Na Fila</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="stat-concluidos">0</div>
            <div class="stat-label">Conclu√≠dos</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="stat-erros">0</div>
            <div class="stat-label">Com Erros</div>
          </div>
        </div>

        <div class="filters">
          <div class="filter">
            <label for="filtro-status-monitor">Status</label>
            <select id="filtro-status-monitor" class="form-control" onchange="filtrarProcessosMonitor()">
              <option value="">Todos</option>
              <option value="processando">Processando</option>
              <option value="aguardando">Aguardando</option>
              <option value="concluido">Conclu√≠do</option>
              <option value="cancelado">Cancelado</option>
            </select>
          </div>
          <div class="filter">
            <label for="filtro-limite-monitor">Mostrar</label>
            <select id="filtro-limite-monitor" class="form-control" onchange="filtrarProcessosMonitor()">
              <option value="10">10 processos</option>
              <option value="20" selected>20 processos</option>
              <option value="50">50 processos</option>
            </select>
          </div>
        </div>

        <div id="lista-processos-monitor" class="jobs">
          <div class="loading"><div class="spinner"></div><span>Carregando processos...</span></div>
        </div>
      </section>

      <!-- Drawer de Resultados -->
      <aside id="results-container" class="drawer">
        <div class="drawer__header">
          <h3>üìä Resultados da Pesquisa</h3>
          <div class="drawer__actions">
            <button class="btn btn-secondary" onclick="exportarResultados()">üì• Exportar</button>
            <button class="btn btn-outline" onclick="fecharResultados()">‚úñÔ∏è Fechar</button>
          </div>
        </div>
        <div id="results-stats" class="stats"></div>
        <div id="results-content" class="drawer__content"></div>
      </aside>
    </main>
  </div>

  <!-- Modal: Novo Processo -->
  <div id="modal-novo-processo" class="modal">
    <div class="modal__content">
      <div class="modal__header">
        <h3>‚ûï Iniciar Novo Processo</h3>
        <button class="modal__close" onclick="fecharModalNovoProcesso()">&times;</button>
      </div>
      <div class="modal__body">
        <form id="form-modal-processo">
          <div class="form-group">
            <label for="tipo-modal">Tipo de Pesquisa</label>
            <select id="tipo-modal" class="form-control" required>
              <option value="">Selecione...</option>
              <option value="detectar_dois_volumes">Detectar Produtos com Dois Volumes</option>
              <option value="pesquisar_texto">Pesquisar Texto Espec√≠fico</option>
            </select>
          </div>
          <div id="grupo-texto-modal" class="form-group" style="display:none;">
            <label for="texto-modal">Texto para Pesquisar</label>
            <input type="text" id="texto-modal" class="form-control" />
          </div>
          <div class="form-group">
            <label for="mlbs-modal">MLBs</label>
            <textarea id="mlbs-modal" class="form-control" rows="6" placeholder="Cole os MLBs aqui..."></textarea>
          </div>
        </form>
      </div>
      <div class="modal__footer">
        <button class="btn btn-outline" onclick="fecharModalNovoProcesso()">Cancelar</button>
        <button class="btn btn-primary" onclick="iniciarProcessoModal()">Iniciar</button>
      </div>
    </div>
  </div>

  <!-- Modal: Detalhes do Job -->
  <div id="modal-detalhes-job" class="modal">
    <div class="modal__content">
      <div class="modal__header">
        <h3>üìä Detalhes do Processo</h3>
        <button class="modal__close" onclick="fecharModalDetalhes()">&times;</button>
      </div>
      <div class="modal__body">
        <div id="detalhes-job-content"></div>
      </div>
      <div class="modal__footer">
        <button class="btn btn-outline" onclick="fecharModalDetalhes()">Fechar</button>
      </div>
    </div>
  </div>

  <!-- bump de vers√£o para for√ßar recarregar JS -->
  <script src="/js/pesquisa-descricao.js?v=4"></script>
</body>
</html>
