<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisa em Descri√ß√µes - API Mercado Livre</title>
    <link rel="stylesheet" href="/css/pesquisa-descricao.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîç Pesquisa em Descri√ß√µes</h1>
            <p>Sistema avan√ßado de pesquisa em massa com processamento inteligente</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="abrirTab('pesquisa-rapida')">
                ‚ö° Pesquisa R√°pida
            </button>
            <button class="nav-tab" onclick="abrirTab('processamento-massa')">
                üöÄ Processamento em Massa
            </button>
            <button class="nav-tab" onclick="abrirTab('monitoramento')">
                üìä Monitoramento
            </button>
        </div>

        <!-- Tab: Pesquisa R√°pida -->
        <div id="pesquisa-rapida" class="tab-content active">
            <div class="alert alert-info">
                <strong>üí° Pesquisa R√°pida:</strong> Ideal para at√© 50 MLBs. Processamento direto com resultados imediatos.
            </div>

            <form id="form-pesquisa-rapida">
                <div class="form-group">
                    <label for="tipo-pesquisa-rapida">Tipo de Pesquisa:</label>
                    <select id="tipo-pesquisa-rapida" class="form-control" required onchange="alterarTipoPesquisaRapida()">
                        <option value="">Selecione o tipo de pesquisa...</option>
                        <option value="detectar_dois_volumes">üîç Detectar Produtos com Dois Volumes</option>
                        <option value="pesquisar_texto">üìù Pesquisar Texto Espec√≠fico</option>
                    </select>
                </div>

                <div id="grupo-texto-rapida" class="form-group" style="display: none;">
                    <label for="texto-pesquisa-rapida">Texto para Pesquisar:</label>
                    <input type="text" id="texto-pesquisa-rapida" class="form-control" placeholder="Digite o texto a ser pesquisado...">
                    <small style="color: #666; margin-top: 5px; display: block;">
                        Exemplos: "kit", "conjunto", "par", "dupla", "dois volumes", etc.
                    </small>
                </div>

                <div class="form-group">
                    <label for="mlbs-rapida">MLBs para Pesquisar:</label>
                    <textarea id="mlbs-rapida" class="form-control" placeholder="Cole os MLBs aqui, um por linha ou separados por v√≠rgula...

Exemplos:
MLB1234567890
MLB9876543210, MLB5556667777
MLB1112223333" required oninput="contarMLBsRapida()"></textarea>
                    
                    <div id="contador-rapida" class="mlb-counter">
                        <div class="counter-info">
                            <div class="counter-item">
                                <div class="counter-number" id="total-mlbs-rapida">0</div>
                                <div class="counter-label">MLBs Detectados</div>
                            </div>
                            <div class="counter-item">
                                <div class="counter-number" id="validos-mlbs-rapida">0</div>
                                <div class="counter-label">V√°lidos</div>
                            </div>
                            <div class="counter-item">
                                <div class="counter-number" id="invalidos-mlbs-rapida">0</div>
                                <div class="counter-label">Inv√°lidos</div>
                            </div>
                        </div>
                        <div id="status-limite-rapida" class="feature-tag">
                            Limite: 50 MLBs
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                    <button type="button" class="btn btn-outline" onclick="limparFormularioRapida()">
                        üóëÔ∏è Limpar
                    </button>
                    <button type="submit" class="btn btn-primary" id="btn-pesquisar-rapida">
                        üîç Pesquisar Agora
                    </button>
                </div>
            </form>
        </div>

        <!-- Tab: Processamento em Massa -->
        <div id="processamento-massa" class="tab-content">
            <div class="alert alert-warning">
                <strong>üöÄ Processamento em Massa:</strong> Para lotes grandes (mais de 50 MLBs). Processamento em background com monitoramento em tempo real.
            </div>

            <!-- Sele√ß√£o do Modo de Processamento -->
            <div class="form-group">
                <label>Escolha o Modo de Processamento:</label>
                
                <div class="processing-mode" id="modo-direto" onclick="selecionarModo('direto')">
                    <h3>‚ö° Processamento Direto</h3>
                    <p>Processamento imediato com resultados na mesma p√°gina. Recomendado para at√© 100 MLBs.</p>
                    <div class="mode-features">
                        <span class="feature-tag">Resultados Imediatos</span>
                        <span class="feature-tag">At√© 100 MLBs</span>
                        <span class="feature-tag">Sem Download</span>
                    </div>
                </div>

                <div class="processing-mode" id="modo-background" onclick="selecionarModo('background')">
                    <h3>üöÄ Processamento em Background</h3>
                    <p>Processamento em fila para grandes volumes. Ideal para milhares de MLBs com download de resultados.</p>
                    <div class="mode-features">
                        <span class="feature-tag">Grandes Volumes</span>
                        <span class="feature-tag">Download de Arquivos</span>
                        <span class="feature-tag">Monitoramento</span>                        <span class="feature-tag">Sem Limite</span>
                    </div>
                </div>
            </div>

            <form id="form-processamento-massa">
                <div class="form-group">
                    <label for="tipo-pesquisa-massa">Tipo de Pesquisa:</label>
                    <select id="tipo-pesquisa-massa" class="form-control" required onchange="alterarTipoPesquisaMassa()">
                        <option value="">Selecione o tipo de pesquisa...</option>
                        <option value="detectar_dois_volumes">üîç Detectar Produtos com Dois Volumes</option>
                        <option value="pesquisar_texto">üìù Pesquisar Texto Espec√≠fico</option>
                    </select>
                </div>

                <div id="grupo-texto-massa" class="form-group" style="display: none;">
                    <label for="texto-pesquisa-massa">Texto para Pesquisar:</label>
                    <input type="text" id="texto-pesquisa-massa" class="form-control" placeholder="Digite o texto a ser pesquisado...">
                    <small style="color: #666; margin-top: 5px; display: block;">
                        O sistema buscar√° este texto em t√≠tulos, descri√ß√µes e atributos dos produtos.
                    </small>
                </div>

                <div class="form-group">
                    <label for="mlbs-massa">MLBs para Processar:</label>
                    <textarea id="mlbs-massa" class="form-control" style="min-height: 200px;" placeholder="Cole os MLBs aqui, um por linha ou separados por v√≠rgula...

Para grandes volumes, voc√™ pode colar:
‚Ä¢ Listas de MLBs de planilhas
‚Ä¢ Resultados de outras consultas
‚Ä¢ Arquivos de texto com MLBs

Exemplos:
MLB1234567890
MLB9876543210
MLB5556667777
..." required oninput="contarMLBsMassa()"></textarea>
                    
                    <div id="contador-massa" class="mlb-counter">
                        <div class="counter-info">
                            <div class="counter-item">
                                <div class="counter-number" id="total-mlbs-massa">0</div>
                                <div class="counter-label">MLBs Detectados</div>
                            </div>
                            <div class="counter-item">
                                <div class="counter-number" id="validos-mlbs-massa">0</div>
                                <div class="counter-label">V√°lidos</div>
                            </div>
                            <div class="counter-item">
                                <div class="counter-number" id="invalidos-mlbs-massa">0</div>
                                <div class="counter-label">Inv√°lidos</div>
                            </div>
                            <div class="counter-item">
                                <div class="counter-number" id="tempo-estimado-massa">0</div>
                                <div class="counter-label">Min. Estimados</div>
                            </div>
                        </div>
                        <div id="status-processamento-massa" class="feature-tag">
                            Modo: N√£o Selecionado
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="forcar-background-massa" onchange="atualizarModoProcessamento()">
                        üîß For√ßar processamento em background (mesmo para lotes pequenos)
                    </label>
                    <small style="color: #666; margin-top: 5px; display: block;">
                        √ötil quando voc√™ quer monitorar o progresso ou baixar resultados em arquivo.
                    </small>
                </div>

                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                    <button type="button" class="btn btn-outline" onclick="limparFormularioMassa()">
                        üóëÔ∏è Limpar
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="validarMLBsMassa()">
                        ‚úÖ Validar MLBs
                    </button>
                    <button type="submit" class="btn btn-primary" id="btn-processar-massa">
                        üöÄ Iniciar Processamento
                    </button>
                </div>
            </form>
        </div>

        <!-- Tab: Monitoramento -->
        <div id="monitoramento" class="tab-content">
            <div class="alert alert-info">
                <strong>üìä Monitoramento:</strong> Acompanhe todos os seus processos em tempo real.
            </div>

            <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="atualizarMonitoramento()">
                    üîÑ Atualizar
                </button>
                <button class="btn btn-success" onclick="abrirModalNovoProcesso()">
                    ‚ûï Novo Processo
                </button>
                <button class="btn btn-warning" onclick="controlarSistema('pausar')" id="btn-pausar-sistema">
                    ‚è∏Ô∏è Pausar Sistema
                </button>
                <button class="btn btn-secondary" onclick="window.open('/dashboard', '_blank')">
                    üè† Dashboard Principal
                </button>
            </div>

            <!-- Estat√≠sticas Gerais -->
            <div id="stats-monitoramento" class="results-stats">
                <div class="stat-card">
                    <div class="stat-number" id="stat-processando">0</div>
                    <div class="stat-label">Processando</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-aguardando">0</div>
                    <div class="stat-label">Na Fila</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-concluidos">0</div>
                    <div class="stat-label">Conclu√≠dos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-erros">0</div>
                    <div class="stat-label">Com Erros</div>
                </div>
            </div>

            <!-- Filtros -->
            <div style="display: flex; gap: 15px; margin: 20px 0; flex-wrap: wrap; align-items: center;">
                <div>
                    <label for="filtro-status-monitor">Status:</label>
                    <select id="filtro-status-monitor" class="form-control" style="width: auto; display: inline-block; margin-left: 5px;" onchange="filtrarProcessosMonitor()">
                        <option value="">Todos</option>
                        <option value="processando">Processando</option>
                        <option value="aguardando">Aguardando</option>
                        <option value="concluido">Conclu√≠do</option>
                        <option value="cancelado">Cancelado</option>
                    </select>
                </div>
                <div>
                    <label for="filtro-limite-monitor">Mostrar:</label>
                    <select id="filtro-limite-monitor" class="form-control" style="width: auto; display: inline-block; margin-left: 5px;" onchange="filtrarProcessosMonitor()">
                        <option value="10">10 processos</option>
                        <option value="20" selected>20 processos</option>
                        <option value="50">50 processos</option>
                    </select>
                </div>
            </div>

            <!-- Lista de Processos -->
            <div id="lista-processos-monitor">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Carregando processos...</span>
                </div>
            </div>
        </div>

        <!-- Container de Resultados -->
        <div id="results-container" class="results-container">
            <div class="results-header">
                <h3>üìä Resultados da Pesquisa</h3>
                <div>
                    <button class="btn btn-secondary" onclick="exportarResultados()">
                        üì• Exportar
                    </button>
                    <button class="btn btn-outline" onclick="fecharResultados()">
                        ‚úñÔ∏è Fechar
                    </button>
                </div>
            </div>
            
            <div id="results-stats" class="results-stats">
                <!-- Estat√≠sticas ser√£o inseridas aqui -->
            </div>
            
            <div id="results-content">
                <!-- Resultados ser√£o inseridos aqui -->
            </div>
        </div>
    </div>

    <!-- Modal: Novo Processo -->
    <div id="modal-novo-processo" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Iniciar Novo Processo</h3>
                <span class="close" onclick="fecharModalNovoProcesso()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="form-modal-processo">
                    <div class="form-group">
                        <label for="tipo-modal">Tipo de Pesquisa:</label>
                        <select id="tipo-modal" class="form-control" required>
                            <option value="">Selecione...</option>
                            <option value="detectar_dois_volumes">Detectar Produtos com Dois Volumes</option>
                            <option value="pesquisar_texto">Pesquisar Texto Espec√≠fico</option>
                        </select>
                    </div>
                    
                    <div id="grupo-texto-modal" class="form-group" style="display: none;">
                        <label for="texto-modal">Texto para Pesquisar:</label>
                        <input type="text" id="texto-modal" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="mlbs-modal">MLBs:</label>
                        <textarea id="mlbs-modal" class="form-control" rows="6" placeholder="Cole os MLBs aqui..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="fecharModalNovoProcesso()">Cancelar</button>
                <button class="btn btn-primary" onclick="iniciarProcessoModal()">Iniciar</button>
            </div>
        </div>
    </div>

    <!-- Modal: Detalhes do Job -->
    <div id="modal-detalhes-job" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìä Detalhes do Processo</h3>
                <span class="close" onclick="fecharModalDetalhes()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="detalhes-job-content">
                    <!-- Conte√∫do ser√° carregado dinamicamente -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="fecharModalDetalhes()">Fechar</button>
            </div>
        </div>
    </div>

    <script src="/js/pesquisa-descricao.js"></script>
</body>
</html>